<section id="our-service-{{ section.id }}" class="py-12 bg-white">
  <div class="max-w-8xl mx-auto px-4 md:px-8">
    <!-- Headings -->
    <div class="text-center mb-8">
      {% if section.settings.heading_small != blank %}
        <p class="text-[16px] tracking-widest text-amber-900 mb-2">{{ section.settings.heading_small }}</p>
      {% endif %}

      <h2 class="ctm-heading !text-[32px] md:!text-[40px] font-bold tracking-tight">{{ section.settings.heading_main }}</h2>
    </div>

    <!-- Buttons row -->
    <div class="overflow-x-auto pb-6">
      <div class="flex gap-4 items-center justify-start md:justify-center" role="tablist">
        {% for block in section.blocks %}
          <button
            type="button"
            class="service-btn inline-flex items-center justify-center py-3 px-8 rounded-[5px] text-[14px] font-semibold shadow-sm border border-transparent focus:outline-none transition-transform transform"
            role="tab"
            aria-controls="service-content-{{ section.id }}-{{ forloop.index0 }}"
            data-service-index="{{ forloop.index0 }}"
            data-section-id="{{ section.id }}"
            id="service-tab-{{ section.id }}-{{ forloop.index0 }}">

            {%- comment -%} we'll inject per-button CSS variables below for colors {%- endcomment -%}
            <span class="service-btn-label">{{ block.settings.button_label | default: 'Service' }}</span>
          </button>
        {% endfor %}
      </div>
    </div>

    <!-- Per-block dynamic style rules (colors & hover) -->
    <style>
      {% for block in section.blocks %}
        {% assign idx = forloop.index0 %}
        #our-service-{{ section.id }}
        .service-btn[data-service-index="{{ idx }}"] {
          {% if block.settings.button_bg_color != blank %}background: {{ block.settings.button_bg_color }};
        {% endif %}
        {% if block.settings.button_text_color != blank %}color: {{ block.settings.button_text_color }};
      {% endif %}
    }
    #our-service-{{ section.id }}.service-btn[data-service-index="{{ idx }}"]:hover {
      {% if block.settings.button_hover_color != blank %}background: {{ block.settings.button_hover_color }};
    {% endif %}
  }
  /* Active state style override â€” will be toggled by JS */
  #our-service-{{ section.id }} .service-btn.active[data-service-index="{{ idx }}"] {
    {% if block.settings.button_active_bg_color != blank %}background: {{ block.settings.button_active_bg_color }};
  {% endif %}
  {% if block.settings.button_active_text_color != blank %}color: {{ block.settings.button_active_text_color }};
{% endif %}
box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
}
{% endfor %}
    </style>

    <!-- Content panes -->
    <div class="mt-8 flex flex-col">
      {% for block in section.blocks %}
        <div
          id="service-content-{{ section.id }}-{{ forloop.index0 }}"
          class="service-content hidden md:grid md:grid-cols-2 gap-8 items-start"
          role="tabpanel"
          aria-labelledby="service-tab-{{ section.id }}-{{ forloop.index0 }}"
          data-service-index="{{ forloop.index0 }}">

          <!-- Image column -->
          <div class="w-full">
            {% if block.settings.image != blank %}
              <div class="overflow-hidden rounded-xl shadow-sm">
                <img
                  width=""
                  height=""
                  src="{{ block.settings.image | img_url: '1600x' }}"
                  alt="{{ block.settings.heading | escape }}"
                  class="w-full h-[250px] md:h-[380px] object-cover" />
              </div>
            {% else %}
              <div class="h-[250px] md:h-[350px] bg-gray-100 rounded-xl"></div>
            {% endif %}
          </div>

          <!-- Details column -->
          <div class="mt-6 md:mt-0 md:pl-10">
            {% if block.settings.caption_small != blank %}
              <p class="text-[16px] uppercase tracking-widest text-amber-900 mb-3">{{ block.settings.caption_small }}</p>
            {% endif %}

            <h3 class="ctm-h3-p6">{{ block.settings.heading }}</h3>

            {% if block.settings.summary_text != blank %}
              <p class="text-gray-500 mb-6 max-w-[540px]">{{ block.settings.summary_text }}</p>
            {% endif %}

            <!-- Two-column bullets list -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
              {% assign first_column_range = "1,2,3" | split: "," %}
              {% assign second_column_range = "4,5,6" | split: "," %}

              <!-- First column -->
              <ul class="space-y-3">
                {% for i in first_column_range %}
                  {% assign icon_key = 'bullet' | append: i | append: '_icon' %}
                  {% assign text_key = 'bullet' | append: i | append: '_text' %}
                  {% assign icon = block.settings[icon_key] %}
                  {% assign text = block.settings[text_key] %}
                  {% if text != blank %}
                    <li class="flex items-center gap-3">
                      {% if icon != blank %}
                        <img
                          width=""
                          height=""
                          src="{{ icon | img_url: '64x' }}"
                          alt=""
                          class="w-5 h-5 mt-1" />
                      {% else %}
                        <svg
                          class="w-5 h-5 mt-1"
                          viewBox="0 0 24 24"
                          fill="none"><path d="M12 2L15 8L22 9L17 14L18 21L12 18L6 21L7 14L2 9L9 8L12 2Z" fill="#b59f70" /></svg>
                      {% endif %}
                      <span class="text-gray-700">{{ text }}</span>
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>

              <!-- Second column -->
              <ul class="space-y-3">
                {% for i in second_column_range %}
                  {% assign icon_key = 'bullet' | append: i | append: '_icon' %}
                  {% assign text_key = 'bullet' | append: i | append: '_text' %}
                  {% assign icon = block.settings[icon_key] %}
                  {% assign text = block.settings[text_key] %}
                  {% if text != blank %}
                    <li class="flex gap-3 items-center">
                      {% if icon != blank %}
                        <img
                          width=""
                          height=""
                          src="{{ icon | img_url: '64x' }}"
                          alt=""
                          class="w-5 h-5 mt-1" />
                      {% else %}
                        <svg
                          class="w-5 h-5 mt-1"
                          viewBox="0 0 24 24"
                          fill="none"><path d="M12 2L15 8L22 9L17 14L18 21L12 18L6 21L7 14L2 9L9 8L12 2Z" fill="#b59f70" /></svg>
                      {% endif %}
                      <span class="text-gray-700">{{ text }}</span>
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            </div>

            <!-- CTA row -->
            <div class="flex items-center gap-4">
              {% if block.settings.view_details_text != blank %}
                <div class="inline-flex items-center bg-[#796F51] text-white gap-3 py-3 px-5 rounded-md border border-gray-200 shadow-sm hover:shadow-md transition">
                  <a href="{{ block.settings.view_details_link }}" class="">
                    <span class="font-semibold">{{ block.settings.view_details_text }}</span>
                  </a>
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 24 24"
                    fill="none"><path
                      d="M5 12h14M13 5l6 7-6 7"
                      stroke="currentColor"
                      stroke-width="1.6"
                      stroke-linecap="round"
                      stroke-linejoin="round" /></svg>
                </div>
              {% endif %}
              {% if block.settings.how_text != blank %}
                <a href="{{ block.settings.how_link }}" class="inline-flex items-center gap-3 pl-4">
                  <span class="inline-flex w-10 h-10 items-center justify-center rounded-full bg-emerald-700 text-white">
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"><path d="M5 3v18l15-9L5 3z" fill="currentColor" /></svg>
                  </span>
                  <span class="text-gray-600">{{ block.settings.how_text }}</span>
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

  </div>

  <!-- Tab switching JS (small & self-contained) -->
  <script>
    (function(){
      const sectionId = "{{ section.id }}";
      const root = document.getElementById('our-service-{{ section.id }}');
      if(!root) return;
    
      const buttons = root.querySelectorAll('.service-btn');
      const panes = root.querySelectorAll('.service-content');
    
      function activate(index){
        buttons.forEach(btn => {
          if(btn.dataset.serviceIndex === String(index)) btn.classList.add('active'); else btn.classList.remove('active');
        });
        panes.forEach(p => {
          if(p.dataset.serviceIndex === String(index)) p.classList.remove('hidden'); else p.classList.add('hidden');
        });
        // accessibility focus management
        const activeTab = root.querySelector('.service-btn.active');
        if(activeTab) activeTab.setAttribute('aria-selected','true');
      }
    
      // initialize - activate first
      if(buttons.length){
        activate(0);
      }
    
      buttons.forEach(btn => {
        btn.addEventListener('click', function(){
          const idx = this.dataset.serviceIndex;
          activate(idx);
        });
    
        // keyboard nav
        btn.addEventListener('keydown', function(e){
          if(e.key === 'ArrowRight' || e.key === 'ArrowDown'){
            e.preventDefault();
            const next = (Number(this.dataset.serviceIndex) + 1) % buttons.length;
            buttons[next].focus();
            activate(next);
          } else if(e.key === 'ArrowLeft' || e.key === 'ArrowUp'){
            e.preventDefault();
            const prev = (Number(this.dataset.serviceIndex) - 1 + buttons.length) % buttons.length;
            buttons[prev].focus();
            activate(prev);
          }
        });
      });
    })();
  </script>

</section>

{%- schema -%}
  {
    "name": "Our Service",
    "settings": [
      {
        "type": "text",
        "id": "heading_small",
        "label": "Small heading (above main)",
        "default": "OUR SERVICE"
      }, {
        "type": "text",
        "id": "heading_main",
        "label": "Main heading",
        "default": "Creative Solutions"
      }
    ],
    "blocks": [
      {
        "type": "service",
        "name": "Service",
        "settings": [
          {
            "type": "text",
            "id": "button_label",
            "label": "Button label",
            "default": "Planning"
          },
          {
            "type": "color",
            "id": "button_bg_color",
            "label": "Button background color",
            "default": "#0b6b3a"
          },
          {
            "type": "color",
            "id": "button_text_color",
            "label": "Button text color",
            "default": "#ffffff"
          },
          {
            "type": "color",
            "id": "button_hover_color",
            "label": "Button hover color",
            "default": "#0a5a31"
          }, {
            "type": "color",
            "id": "button_active_bg_color",
            "label": "Active button background",
            "default": "#0b6b3a"
          }, {
            "type": "color",
            "id": "button_active_text_color",
            "label": "Active button text color",
            "default": "#ffffff"
          }, {
            "type": "image_picker",
            "id": "image",
            "label": "Hero image"
          }, {
            "type": "text",
            "id": "caption_small",
            "label": "Small caption (upper)",
            "default": "PLANNING"
          }, {
            "type": "text",
            "id": "heading",
            "label": "Content heading",
            "default": "Thoughtful Planning For Timeless Spaces"
          }, {
            "type": "textarea",
            "id": "summary_text",
            "label": "Summary text",
            "default": "Elit lacus vivamus sollicitudin sapien congue accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi."
          }, {
            "type": "image_picker",
            "id": "bullet1_icon",
            "label": "Bullet 1 icon (svg/png)"
          }, {
            "type": "text",
            "id": "bullet1_text",
            "label": "Bullet 1 text",
            "default": "Dictumst urna nisi elit"
          }, {
            "type": "image_picker",
            "id": "bullet2_icon",
            "label": "Bullet 2 icon (svg/png)"
          }, {
            "type": "text",
            "id": "bullet2_text",
            "label": "Bullet 2 text",
            "default": "Metus facilisi urna cras"
          }, {
            "type": "image_picker",
            "id": "bullet3_icon",
            "label": "Bullet 3 icon (svg/png)"
          }, {
            "type": "text",
            "id": "bullet3_text",
            "label": "Bullet 3 text",
            "default": "Nullam integer aliquet"
          }, {
            "type": "image_picker",
            "id": "bullet4_icon",
            "label": "Bullet 4 icon (svg/png)"
          }, {
            "type": "text",
            "id": "bullet4_text",
            "label": "Bullet 4 text",
            "default": "Natoque makisent amet"
          }, {
            "type": "image_picker",
            "id": "bullet5_icon",
            "label": "Bullet 5 icon (svg/png)"
          }, {
            "type": "text",
            "id": "bullet5_text",
            "label": "Bullet 5 text",
            "default": "Feugiat purus praesent"
          }, {
            "type": "image_picker",
            "id": "bullet6_icon",
            "label": "Bullet 6 icon (svg/png)"
          }, {
            "type": "text",
            "id": "bullet6_text",
            "label": "Bullet 6 text",
            "default": "Nisi elit urna dictumst"
          }, {
            "type": "text",
            "id": "view_details_text",
            "label": "View details CTA text",
            "default": "View Details"
          }, {
            "type": "url",
            "id": "view_details_link",
            "label": "View details link"
          }, {
            "type": "text",
            "id": "how_text",
            "label": "How it works text",
            "default": "How It Works"
          }, {
            "type": "url",
            "id": "how_link",
            "label": "How it works link"
          }
        ]
      }
    ],
    "max_blocks": 5,
    "presets": [
      {
        "name": "Our Service (Tabbed)",
        "category": "Sections",
        "blocks": [
          {
            "type": "service"
          },
          {
            "type": "service"
          },
          {
            "type": "service"
          },
          {
            "type": "service"
          }, {
            "type": "service"
          }
        ]
      }
    ]
  }
{%- endschema -%}