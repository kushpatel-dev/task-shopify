<section class="py-12 bg-white">
  <div class="max-w-full mx-10 md:mx-14 lg:mx-[100px] xl:mx-[200px] px-4 lg:flex lg:gap-8">

    <!-- LEFT SIDE: IMAGE CAROUSEL -->
    <div class="lg:w-1/2">
      <div class="relative">
          <!-- Main Image -->
        <img
          height=""
          width=""
          id="mainImage"
          src="{{ section.settings.main_image | img_url: '800x' }}"
          alt="Main product image"
          class="w-full h-[400px] lg:h-[500px] object-cover">

        <!-- Prev Button -->
        <button id="prevBtn" class="flex w-10 h-10 justify-center items-center absolute left-4 top-1/2 transform -translate-y-1/2 bg-red-600 text-white p-2 rounded-full hover:bg-red-700">
          &lt;
        </button>
        <!-- Next Button -->
        <button id="nextBtn" class="flex w-10 h-10 justify-center items-center absolute right-4 top-1/2 transform -translate-y-1/2 bg-red-600 text-white p-2 rounded-full hover:bg-red-700">
          &gt;
        </button>
      </div>
      <!-- Thumbnails -->
      <div class="flex flex-row justify-evenly items-center">
        {% for block in section.blocks %}
          <div
            class="relative rounded-lg overflow-hidden transition data-[active=true]:ring-2 data-[active=true]:ring-red-600/40"
            data-thumb
            data-index="{{ forloop.index0 }}"
            data-active="false">
            <img
              height=""
              width=""
              src="{{ block.settings.thumbnail | img_url: '200x' }}"
              alt="Thumbnail"
              class="ctm-img-p8 thumbnail"
              data-image="{{ block.settings.thumbnail | img_url: '800x' }}">
            <!-- Red overlay shown only when this thumb is active -->
            <div class="active-overlay absolute inset-0 bg-red-600/40 opacity-0 transition duration-200" data-active="false"></div>
          </div>
        {% endfor %}
      </div>

    </div>

    <!-- RIGHT SIDE: PRODUCT DETAILS -->
    <div class="lg:w-1/2 mt-8 lg:mt-0">
      <!-- Title & Price -->
      <h2 class="ctm-h2-p8">{{ section.settings.title }}</h2>
      <div class="flex items-center gap-2 mt-2">
        <span class="text-[#A6192E] !text-[20px] !font-extrabold">{{ section.settings.price }}</span>
        <img
          height=""
          width=""
          src="{{ section.settings.star_image | img_url: '200x' }}"
          alt="Star Rating"
          class="h-8">
      </div>

      <!-- Description -->
      <h3 class="!text-[32px] !font-extrabold mt-4">{{ section.settings.subtitle }}</h3>
      <p class="mt-2 text-gray-700 text-[14px]">{{ section.settings.description }}</p>
      <p class="mt-4 font-bold">{{ section.settings.bold_text }}</p>
      <p class="font-bold">{{ section.settings.question_text }}</p>

      <!-- Pricing Options -->
      <div class="flex gap-4 mt-6">
        <div class="border-2 border-red-600 rounded-lg p-4 cursor-pointer hover:shadow-lg transition w-1/2 text-center">
          <h4 class="text-red-600 font-bold">{{ section.settings.recorded_label }}</h4>
          <span class="text-red-600 font-bold text-xl">{{ section.settings.recorded_price }}</span>
        </div>
        <div class="border rounded-lg p-4 cursor-pointer hover:shadow-lg transition w-1/2 text-center">
          <h4 class="font-bold">{{ section.settings.live_label }}</h4>
          <span class="font-bold text-xl">{{ section.settings.live_price }}</span>
        </div>
      </div>

      <div class="mt-4 flex items-center gap-2">
        <input
          type="checkbox"
          id="terms"
          class="ctm-check">
        <label for="terms" class="text-sm">{{ section.settings.terms_text }}</label>
      </div>


      <!-- Quantity Selector -->
      <div class="flex items-center gap-4 mt-6">
        <span class="!font-extrabold">Quantity:</span>
        <div class="flex items-center rounded-full border border-[#8B0A10] overflow-hidden h-8">
          <button id="decreaseQty" class="flex items-center justify-center w-8 h-8 text-gray-700 select-none">
            −
          </button>
          <input
            id="quantity"
            type="text"
            value="1"
            class="w-10 h-8 text-center outline-none border-0 focus:ring-0 text-gray-800"
            inputmode="numeric"
            pattern="[0-9]*" />
          <button id="increaseQty" class="flex items-center justify-center w-8 h-8 text-gray-700 select-none">
            +
          </button>
        </div>

      </div>

      <!-- Buttons -->
      <div class="flex gap-4 mt-8">
        <button class="bg-[#A6192E] text-white px-6 py-2 rounded-full hover:bg-red-700 transition font-bold">
          {{ section.settings.register_button }}
        </button>
        <button class="border-2 border[#A6192E] text-red-600 px-6 py-2 rounded-full hover:bg-[#A6192E] hover:text-white transition font-bold flex items-center gap-2">
          {{ section.settings.shop_button }}
        </button>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", function () {
  const thumbnails = document.querySelectorAll("[data-image]");
  const mainImage  = document.getElementById("mainImage");
  const wrappers   = document.querySelectorAll("[data-thumb]");
  const overlays   = document.querySelectorAll(".active-overlay");
  const images     = Array.from(thumbnails).map(img => img.dataset.image);
  
  if (!thumbnails.length) return;
  
  let currentIndex = 0;
  
  function updateActiveState(index) {
    // Reset all
    wrappers.forEach(w => w.setAttribute("data-active", "false"));
    overlays.forEach(o => o.setAttribute("data-active", "false"));
    overlays.forEach(o => o.style.opacity = "0");
  
    // Activate current
    wrappers[index]?.setAttribute("data-active", "true");
    overlays[index]?.setAttribute("data-active", "true");
    overlays[index].style.opacity = "1"; // shows bg-red-600/40 at full (i.e., 40% red)
  }
  
  // Initialize
  mainImage.src = images[0] || mainImage.src;
  updateActiveState(currentIndex);
  
  // Click handlers for thumbnails
  thumbnails.forEach((thumb, index) => {
    thumb.addEventListener("click", () => {
      currentIndex = index;
      mainImage.src = images[currentIndex];
      updateActiveState(currentIndex);
    });
  });
  
  // Prev/Next buttons
  document.getElementById("prevBtn")?.addEventListener("click", () => {
    currentIndex = (currentIndex - 1 + images.length) % images.length;
    mainImage.src = images[currentIndex];
    updateActiveState(currentIndex);
  });
  
  document.getElementById("nextBtn")?.addEventListener("click", () => {
    currentIndex = (currentIndex + 1) % images.length;
    mainImage.src = images[currentIndex];
    updateActiveState(currentIndex);
  });
  
  // Quantity (+/-) — defensive binds
  document.getElementById("increaseQty")?.addEventListener("click", () => {
    const qty = document.getElementById("quantity");
    qty.value = (parseInt(qty.value || "1", 10) + 1).toString();
  });
  
  document.getElementById("decreaseQty")?.addEventListener("click", () => {
    const qty = document.getElementById("quantity");
    const val = Math.max(1, parseInt(qty.value || "1", 10) - 1);
    qty.value = val.toString();
  });
  });
</script>

{% schema %}
  {
    "name": "Coaching Product Section",
    "settings": [
      {
        "type": "image_picker",
        "id": "main_image",
        "label": "Main Image"
      },
      {
        "type": "text",
        "id": "title",
        "label": "Title",
        "default": "Online Group Coaching"
      },
      {
        "type": "text",
        "id": "price",
        "label": "Main Price",
        "default": "$300.00"
      },
      {
        "type": "image_picker",
        "id": "star_image",
        "label": "Star Rating Image"
      }, {
        "type": "text",
        "id": "subtitle",
        "label": "Subtitle (Bold)",
        "default": "THE E.D.G.E. IMMERSION: A 12-WEEK JOURNEY OF BECOMING."
      }, {
        "type": "textarea",
        "id": "description",
        "label": "Description"
      }, {
        "type": "text",
        "id": "bold_text",
        "label": "Bold Statement",
        "default": "This is not just change. This is the art of becoming."
      }, {
        "type": "text",
        "id": "question_text",
        "label": "Question Text",
        "default": "Are you ready to step into your masterpiece?"
      }, {
        "type": "text",
        "id": "recorded_label",
        "label": "Recorded Label",
        "default": "Recorded Version"
      }, {
        "type": "text",
        "id": "recorded_price",
        "label": "Recorded Price",
        "default": "$300.00"
      }, {
        "type": "text",
        "id": "live_label",
        "label": "Live Label",
        "default": "Live Component"
      }, {
        "type": "text",
        "id": "live_price",
        "label": "Live Price",
        "default": "$1,100.00"
      }, {
        "type": "text",
        "id": "terms_text",
        "label": "Terms & Conditions Text",
        "default": "I agree to Terms and Conditions for training certification"
      }, {
        "type": "text",
        "id": "register_button",
        "label": "Register Button Text",
        "default": "REGISTER NOW"
      }, {
        "type": "text",
        "id": "shop_button",
        "label": "Shop Pay Button Text",
        "default": "BUY WITH ShopPay"
      }
    ],
    "blocks": [
      {
        "type": "thumbnail",
        "name": "Thumbnail Image",
        "settings": [
          {
            "type": "image_picker",
            "id": "thumbnail",
            "label": "Thumbnail Image"
          }
        ]
      }
    ],
    "max_blocks": 4,
    "presets": [
      {
        "name": "Coaching Product Section"
      }
    ]
  }
{% endschema %}